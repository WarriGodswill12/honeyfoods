// Honey Foods Database Schema
// This schema defines all database models for the e-commerce platform

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// Admin user model
model User {
  id            String    @id @default(cuid())
  email         String    @unique
  name          String?
  passwordHash  String
  role          Role      @default(ADMIN)
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
}

enum Role {
  ADMIN
  SUPER_ADMIN
}

// Product model
model Product {
  id            String      @id @default(cuid())
  name          String
  slug          String      @unique
  description   String?
  price         Int
  image         String
  imagePublicId String?     // Cloudinary public ID for deletion
  available     Boolean     @default(true)
  featured      Boolean     @default(false)
  category      String?
  createdAt     DateTime    @default(now())
  updatedAt     DateTime    @updatedAt
  orderItems    OrderItem[]
  
  @@index([available, featured])
  @@index([slug])
}

// Order model
model Order {
  id              String        @id @default(cuid())
  orderNumber     String        @unique
  customerName    String
  customerEmail   String?
  customerPhone   String
  deliveryAddress String
  customNote      String?
  
  subtotal        Int
  deliveryFee     Int         @default(0)
  total           Int
  
  status          OrderStatus   @default(PENDING)
  paymentStatus   PaymentStatus @default(PENDING)
  paymentMethod   String?
  
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt
  
  orderItems      OrderItem[]
  payment         Payment?
  
  @@index([orderNumber])
  @@index([status])
  @@index([paymentStatus])
  @@index([createdAt])
}

enum OrderStatus {
  PENDING
  CONFIRMED
  PREPARING
  OUT_FOR_DELIVERY
  DELIVERED
  CANCELLED
}

enum PaymentStatus {
  PENDING
  PAID
  FAILED
  REFUNDED
}

// Order items (products in an order)
model OrderItem {
  id        String   @id @default(cuid())
  orderId   String
  productId String
  
  name      String   // Snapshot of product name
  price     Int      // Snapshot of price at time of order
  quantity  Int
  subtotal  Int
  
  order     Order    @relation(fields: [orderId], references: [id], onDelete: Cascade)
  product   Product  @relation(fields: [productId], references: [id], onDelete: Restrict)
  
  @@index([orderId])
  @@index([productId])
}

// Payment model
model Payment {
  id                String        @id @default(cuid())
  orderId           String        @unique
  
  amount            Int
  currency          String        @default("NGN")
  
  provider          String        // 'stripe', 'paystack', 'applepay'
  providerPaymentId String?       // Payment ID from provider
  providerMetadata  Json?         // Additional provider data
  
  status            PaymentStatus @default(PENDING)
  
  createdAt         DateTime      @default(now())
  updatedAt         DateTime      @updatedAt
  
  order             Order         @relation(fields: [orderId], references: [id], onDelete: Cascade)
  
  @@index([orderId])
  @@index([providerPaymentId])
}

// Gallery images model
model GalleryImage {
  id        String   @id @default(cuid())
  type      String   @default("gallery") // "hero" or "gallery"
  url       String
  alt       String
  featured  Boolean  @default(false) // Featured images appear in homepage slider
  order     Int
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  @@index([type, featured, order])
}

// Store Settings model
model Settings {
  id                      String   @id @default(cuid())
  deliveryFee             Int    @default(1500)
  freeDeliveryThreshold   Int    @default(10000)
  minOrderAmount          Int    @default(500)
  storeName               String   @default("HoneyFoods")
  storeTagline            String   @default("Taste is everything")
  storeEmail              String   @default("info@honeyfoods.com")
  storePhone              String   @default("+234 123 456 7890")
  storeAddress            String   @default("123 Main Street, Lagos, Nigeria")
  storeCity               String   @default("Lagos")
  storePostalCode         String   @default("100001")
  heroBackgroundImage     String   @default("https://images.unsplash.com/photo-1512058564366-18510be2db19?w=1920&q=80")
  aboutUsImage            String   @default("https://images.unsplash.com/photo-1556910103-1c02745aae4d?w=1200&q=80")
  updatedAt               DateTime @updatedAt
}
